%\begin{table}
%\label{code:modified2}
\begin{scriptsize}
%\begin{lstlisting}[name={A secured implementation of Verify},
%                   caption=\lstname,
%                   label=code:modified]
\begin{lstlisting}[]
signed char triesLeft = maxTries; signed char triesLeftBackup = -maxTries;
BYTE  equal = BOOL_TRUE; BYTE authenticated = 0;
BYTE pin[4]={(char)0,(char)1,char(2),char(3)};
BYTE Verify(char buffer[4]) {
   int i;
//BLOCK entry
   int stepCounter = INITIAL_VALUE;
   short char t1 = triesLeft;
   if(t1 != -triesLeftBackup) goto CM ;
//BLOCK bb
   if(triesLeft <= 0) return EXIT_FAILURE;
//BLOCK bb2
   t1--; triesLeft = t1; triesLeftBackup++;
   if(triesLeft != -triesLeftBackup) goto CM ;
//BLOCK bb3
   equal = BOOL_TRUE;
   for(i = 0; i < 4; i++)
      {equal=equal&((buffer[i]!=pin[i])?BOOL_FALSE:BOOL_TRUE);
       stepCounter++; };
//BLOCK bb9
   if(equal == BOOL_TRUE) {
//BLOCK 10
      if(equal != BOOL_TRUE) goto CM ;
//BLOCK bb11
      triesLeft = maxTries; triesLeftBackup = -maxTries;
      if (triesLeft != -triesLeftBackup) goto CM ;
//BLOCK bb12
      authenticated = 1;
      if(stepCounter == INITIAL_VALUE + 4) 
//BLOCK bb13 
         return EXIT_SUCCESS; }
//BLOCK bb14 : else part of  block bb12 
//             followed by block CM
   else { // Comparison failed
      authenticated = 0;
      if(stepCounter == INITIAL_VALUE + 4) 
//BLOCK bb16
         return EXIT_FAILURE; }
// BLOCK  CM
        CM : printf("Card blocked.\n");
        return EXIT_FAILURE;
}
\end{lstlisting}
\end{scriptsize}
%\end{table}
