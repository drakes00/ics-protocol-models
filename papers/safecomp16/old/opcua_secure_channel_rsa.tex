\begin{figure}[htb]
    \centering
    \renewcommand{\smname}{\smseshort}
    \resizebox{.8\linewidth}{!}{
        \begin{postscript}
            \begin{msc}{Secure channel creation}
                \setlength{\envinstdist}{1.5\envinstdist}
                \setlength{\instdist}{2.6\instdist}
                \setlength{\labeldist}{1.5\labeldist}

                \declinst{cli}{C}{}
                \declinst{intruder}{DiscoreryEndpoint}{}
                \declinst{sess}{S}{}

                \msccomment[-.5]{1.}{cli}
                \mess{\gereq}{cli}{intruder}
                \nextlevel[1.5]

                \msccomment[-.5]{2.}{cli}
                \mess{\geres, pk(S), \smname, SP, UP}{intruder}{cli}
                \nextlevel[1]
                
                %\action*{Validates pk(S)}{cli}
                %\nextlevel[2]
                
                \action*{Generates N$_{C}$}{cli}
                \nextlevel[3]

                \msccomment[-.5]{3.}{cli}
                \mess{pk(C), \sm{\oscreq, pk(C), $N_{C}$}{pk(S)}{sk(C)}}{cli}{sess}
                \nextlevel[1]

                %\action*{Validates pk(C) }{sess}
                %\nextlevel[2]

                \action*{Generates N$_{S}$ }{sess}
                \nextlevel[2]

                %\ifsmnotnone{%
                %    \action*{$(K_{SC}, KSig_{SC})$ = $P\_hash(N_{S}, N_{C})$ }{sess}
                %    \nextlevel[3.5]
                %}

                \msccomment[-.5]{4.}{cli}
                \mess{\sm{\oscres, $N_{S}$, ST, TTL}{pk(C)}{sk(S)}}{sess}{cli}
                \nextlevel[1]

                %\ifsmnotnone{%
                %    \action*{$(K_{CS}, KSig_{CS})$ = $P\_hash(N_{C}, N_{S})$ }{cli}
                %    \nextlevel[2]
                %}
            \end{msc}
        \end{postscript}
    }
    \caption{\opcua \securechan sub-protocol}
    \label{fig:secure_channel_se}
\end{figure}

C et S s'échangent les nonces Nc et Ns et dérivent chacun quatre clefs:
\begin{itemize}
    \item $(K_{CS}, KSig_{CS})$ = $P\_hash(N_{C}, N_{S})$
    \item $(K_{SC}, KSig_{SC})$ = $P\_hash(N_{S}, N_{C})$
\end{itemize}

\begin{table}[htb]
    \centering
    %\hspace{-1em}
    %\resizebox{1.05\columnwidth}{!}{
    \begin{tabular}{|c|c|c|c|c|}
        \hline
        \multirow{2}{*}{\opcua Security mode} & \multicolumn{4}{|c|}{Objectives} \\
        \cline{2-5}
                       & Sec $K_{cli}$ & Sec $K_{srv}$ & Auth $g^{N_{S}}$  & Auth $g^{N_{C}}$  \\
        \hline
        \smn           & \UNSAFE       & \UNSAFE       & \UNSAFE           & \UNSAFE           \\ 
        \hline
        \sms           & \UNSAFE       & \UNSAFE       & \UNSAFE           & \UNSAFE           \\ 
        \hline
        \smseshort     & \SAFE         & \SAFE         & \UNSAFE           & \UNSAFE           \\ 
        \hline
    \end{tabular}
    %}
    \caption{Results for textbook {\em OpenSecureChannel} sub-protocol}
    \label{tab:secure_channel_results}
\end{table}

Attaques sur le secret en Sign car les nonces sont échangés en clair (pas besoin
de figure).
Attaque sur l'auth partout car besoin de préciser les destinataires dans les signs (figure).

\begin{table}[htb]
    \centering
    %\hspace{-1em}
    %\resizebox{1.05\columnwidth}{!}{
    \begin{tabular}{|c|c|c|c|c|}
        \hline
        \multirow{2}{*}{\opcua Security mode} & \multicolumn{4}{|c|}{Objectives} \\
        \cline{2-5}
                       & Sec $K_{cli}$ & Sec $K_{srv}$ & Auth $g^{N_{S}}$  & Auth $g^{N_{C}}$  \\
        \hline
        \smn           & \UNSAFE       & \UNSAFE       & \UNSAFE           & \UNSAFE           \\ 
        \hline
        \sms           & \UNSAFE       & \UNSAFE       & \SAFE             & \SAFE             \\ 
        \hline
        \smseshort     & \SAFE         & \SAFE         & \SAFE             & \SAFE             \\ 
        \hline
    \end{tabular}
    %}
    \caption{Results for fixed {\em OpenSecureChannel} sub-protocol}
    \label{tab:secure_channel_fix_results}
\end{table}

Si précise les destinataires dans les signs, auth deviennent safe.
